{% load static %}
<!-- 
 {% csrf_token %}  
 -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Édition du profil</title>
  <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>
  <form id="profileForm" action="/profile/users" method="POST" enctype="multipart/form-data">
    <div class="form-actions">
      <a href="/profile" class="cancel-btn">Annuler</a>
      <button type="submit" class="save-btn">Enregistrer</button>
    </div>
    <div class="banner-container">
      <img id="banner" src="default-banner.jpg" alt="Bannière">
      <input type="file" name="banner" id="bannerInput" style="display: none">
      <button type="button" onclick="editField('banner')">✎</button>
    </div>

    <div class="photo-container">
      <img id="photo" src="default-photo.jpg" alt="Photo de profil">
      <input type="file" name="photo" id="photoInput" style="display: none">
      <span class="edit-icon">✎</span>
      <button type="button" onclick="editField('photo')"></button>
    </div>

    <div class="field">
      <label for="lastNameInput">Nom :</label>
      <span id="lastName">Marega</span>
      <input type="hidden" name="lastName" id="lastNameInput" value="Marega">
      <button type="button" onclick="editField('lastName')">✎</button>
    </div>

    <div class="field">
      <label for="firstNameInput">Prénom :</label>
      <span id="firstName">Djibril</span>
      <input type="hidden" name="firstName" id="firstNameInput" value="Djibril">
      <button type="button" onclick="editField('firstName')">✎</button>
    </div>

    <div class="field">
      <label for="bioInput">Bio :</label>
      <span id="bio">Développeur passionné de systèmes distribués et de sécurité.</span>
      <input type="hidden" name="bio" id="bioInput" value="Développeur passionné de systèmes distribués et de sécurité.">
      <button type="button" onclick="editField('bio')">✎</button>
    </div>

    <div class="field">
      <label for="birthDateInput">Date de naissance :</label>
      <span id="birthDate">2000-01-01</span>
      <input type="hidden" name="birthDate" id="birthDateInput" value="2000-01-01">
      <button type="button" onclick="editField('birthDate')">✎</button>
    </div>
  </form>
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <h2 id="modalTitle">Modifier</h2>
      <input id="modalInput" type="text" class="modal-input">
      <input id="modalInputDate" type="date" class="modal-input hidden">
      <div class="modal-actions">
        <button id="modalSave">Enregistrer</button>
        <button id="modalClose" class="modal-cancel">Annuler</button>
      </div>
    </div>
  </div>
</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const fields = ['lastName', 'firstName', 'bio', 'birthDate']; // Ajout de birthDate
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const modalInputText = document.getElementById('modalInput');      // input type="text"
  const modalInputDate = document.getElementById('modalInputDate');  // input type="date"
  const modalSave = document.getElementById('modalSave');
  const modalClose = document.getElementById('modalClose');

  let currentField = '';

  fields.forEach(field => {
    const container = document.getElementById(field).parentElement;
    container.classList.add('editable');
    container.addEventListener('click', () => openModal(field));
  });

  document.querySelector('.photo-container').addEventListener('click', () => editImage('photo'));
  document.querySelector('.banner-container').addEventListener('click', () => editImage('banner'));

  function openModal(fieldId) {
    currentField = fieldId;
    const span = document.getElementById(fieldId);
    const input = document.getElementById(fieldId + 'Input');
    modalTitle.textContent = 'Modifier ' + fieldId;

    // Affiche seulement le champ de type approprié
    if (fieldId === 'birthDate') {
      modalInputText.classList.add('hidden');
      modalInputDate.classList.remove('hidden');
      modalInputDate.value = input.value;
    } else {
      modalInputDate.classList.add('hidden');
      modalInputText.classList.remove('hidden');
      modalInputText.value = span.textContent;
    }

    modal.classList.remove('hidden');
  }

  modalSave.addEventListener('click', () => {
    const span = document.getElementById(currentField);
    const input = document.getElementById(currentField + 'Input');

    if (currentField === 'birthDate') {
      const newValue = modalInputDate.value;
      if (newValue) {
        span.textContent = newValue;
        input.value = newValue;
      }
    } else {
      const newValue = modalInputText.value;
      if (newValue) {
        span.textContent = newValue;
        input.value = newValue;
      }
    }

    modal.classList.add('hidden');
  });


  modalClose.addEventListener('click', () => modal.classList.add('hidden'));

  function editImage(fieldId) {
    const inputFile = document.getElementById(fieldId + 'Input');
    inputFile.click();
    inputFile.onchange = () => {
      const file = inputFile.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          document.getElementById(fieldId).src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    };
  }
});
</script>
